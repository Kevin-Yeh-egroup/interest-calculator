# 信用卡循環利息試算器

## 🔴 緊急修復完成

### 1. 修正循環利息計算邏輯
- **問題**：繳款截止日前繳清不應產生循環利息
- **修復**：在 `calculatePurchaseInterest` 函數中添加繳款截止日檢查
- **邏輯**：如果繳款截止日前已繳清該筆消費，則不計算循環利息

### 2. 修正銀行統計計算
- **問題**：已繳款金額未被扣除，剩餘欠款計算錯誤
- **修復**：在 `calculateBankInterest` 函數中正確傳遞繳款截止日參數
- **結果**：剩餘欠款 = 總消費金額 - 已繳款金額

### 3. 修正下期帳單計算
- **問題**：已還款金額不應包含在下期帳單中
- **修復**：下期帳單總額 = 剩餘欠款 + 循環利息 + 違約金
- **說明**：已還款金額不會重複計算

### 4. 修復時間軸重複顯示
- **問題**：同一筆消費在消費日與入帳日重複出現
- **修復**：在 `generateTimeline` 函數中只顯示消費日，保留入帳日資訊但不重複顯示
- **改善**：時間軸更清晰，避免混淆

## 🟡 功能改善完成

### 1. 增加違約金計算
- **功能**：帳單金額考量違約金
- **實作**：在 `calculateInterest` 函數中檢查是否達最低應繳
- **計算**：違約金 = 未達最低應繳時收取固定金額

### 2. 合併繳款類型選項
- **問題**：「部分繳清」與「自訂金額」功能重複
- **改善**：重新設計繳款類型選項
  - 全額繳清：自動計算總欠款金額
  - 最低應繳：自動計算最低應繳金額
  - 自訂金額：手動輸入繳款金額

### 3. 增加編輯功能
- **功能**：可直接修改消費記錄或繳款記錄
- **實作**：
  - 添加編輯狀態管理
  - 編輯彈窗支援修改金額、日期、說明
  - 消費記錄支援修改入帳日期
- **優勢**：無須刪除重建，提高使用效率

### 4. 增加銀行資訊記憶功能
- **功能**：已設定的銀行可直接選擇，無須重新設定
- **實作**：
  - 銀行名稱下拉選單顯示已設定的銀行
  - 選擇銀行時自動填入該銀行的設定參數
  - 支援手動輸入新銀行名稱

### 5. 介面整合優化
- **功能**：信用卡基本設定與新增消費記錄合併
- **改善**：
  - 將原本分開的兩個卡片合併為一個
  - 銀行設定區和消費記錄區用分隔線區分
  - 減少頁面滾動，提升操作效率

### 6. 預設銀行名稱列表
- **功能**：提供完整的台灣銀行列表
- **包含**：26家主要銀行，包含：
  - 中國信託、兆豐商銀、國泰世華、玉山商銀
  - 聯邦商銀、上海商銀、永豐商銀、渣打商銀
  - 凱基銀行、台北富邦、遠東商銀、台新銀行
  - 安泰商銀、星展銀行(台灣)、新光銀行、元大商銀
  - 陽信商銀、華泰商業銀行、三信商銀、第一銀行
  - 華南商銀、樂天信用卡、台中商銀、王道銀行(O-Bank)
  - 將來商業銀行、連線銀行

### 7. 銀行選擇體驗優化
- **功能**：智能銀行名稱輸入與提示
- **改善**：
  - 移除分離的銀行選擇和輸入按鈕
  - 支援直接輸入銀行名稱
  - 根據輸入字自動提示符合的銀行選項
  - 點擊提示選項自動填入銀行設定

### 8. 介面標題優化
- **功能**：改善用戶介面標題和描述
- **改善**：
  - "選擇銀行查看記錄" 改為 "選擇銀行查看信用卡使用紀錄"
  - 移除 "新增消費記錄" 標題，簡化介面
  - 提升介面的一致性和專業性

### 9. 銀行選擇介面完善
- **功能**：銀行名稱選擇與輸入雙重支援
- **改善**：
  - 添加下拉式選單，快速選擇預設銀行
  - 保留手動輸入功能，支援自訂銀行名稱
  - 選擇銀行時自動填入相關設定

### 10. 佈局優化
- **功能**：調整主要功能區塊佈局
- **改善**：
  - 循環利息計算結果移至中間位置，提升重要性
  - 信用卡使用紀錄移至右側，便於查看
  - 優化用戶操作流程和視覺重點

### 11. 銀行選擇介面整合
- **功能**：將下拉式選單和自行輸入合併為智能組合輸入框
- **改善**：
  - 單一輸入框整合所有銀行選擇功能
  - 支援直接輸入和智能提示
  - 點擊右側銀行圖示可清空輸入並顯示所有選項
  - 自動過濾匹配的銀行名稱
  - 支援自訂銀行名稱輸入

### 12. 銀行日期計算規則整合
- **功能**：根據實際銀行規則自動計算結帳日和繳款截止日
- **改善**：
  - 整合26家主要銀行的實際結帳日和繳款日規則
  - 支援多種日期計算模式：
    - 結帳日加固定天數（如：結帳日+15天）
    - 固定繳款日（如：每月20日）
    - 月底結帳（如：彰化銀行）
  - 選擇銀行時自動填入正確的結帳日選項
  - 結帳日變更時自動重新計算繳款截止日
  - 支援自訂銀行設定

### 13. 銀行結帳日選擇優化
- **功能**：智能結帳日選擇介面
- **改善**：
  - 選擇銀行後，結帳日欄位變為下拉選單
  - 顯示該銀行所有可選的結帳日
  - 支援特殊日期（如"月底"）
  - 未選擇銀行時顯示手動輸入欄位
  - 提升用戶體驗和計算準確性

### 14. 銀行選擇體驗優化
- **功能**：改善銀行選擇後的用戶體驗
- **改善**：
  - 選擇銀行後，下拉選單自動隱藏，避免干擾
  - 只在輸入時顯示過濾提示，提升介面整潔度
  - 支援自訂銀行名稱輸入，保持靈活性
  - 優化銀行選擇流程，減少視覺干擾

### 15. 繳款狀態與循環利息整合
- **功能**：將循環利息資訊整合到繳款狀態顯示中
- **改善**：
  - 繳款狀態區塊同時顯示循環利息和剩餘欠款
  - 添加循環利息提醒，警告未繳清將產生循環利息
  - 使用顏色區分不同類型的金額（利息、欠款）
  - 提升用戶對循環利息的認知和警覺性

### 16. 循環利息顯示邏輯優化
- **功能**：根據實際業務邏輯調整循環利息顯示
- **改善**：
  - 循環利息卡片移至繳款狀態下方，符合邏輯順序
  - 只有當有循環利息時才顯示循環利息卡片
  - 明確說明循環利息是「上期未繳清產生的」
  - 繳款狀態專注顯示當前繳款狀況和剩餘欠款
  - 提升用戶對循環利息產生原因的理解

### 17. 繳款狀態簡化與帳單明細優化
- **功能**：簡化繳款狀態顯示，優化下期帳單明細
- **改善**：
  - 繳款狀態專注顯示繳款狀況和剩餘欠款，移除循環利息資訊
  - 下期帳單預估新增明細列表，清楚顯示帳單總額組成
  - 帳單明細包含：剩餘欠款、循環利息（如有）、違約金（如有）
  - 使用顏色區分不同費用類型，提升視覺辨識度
  - 總計金額與明細分離，讓用戶清楚了解費用結構

## 📋 銀行日期規則詳情

### 結帳日規則
- **中國信託**：每月 5、7、10、12、15、17、20、22、25、27 日
- **國泰世華**：每月 3、5、7、8、9、10、15、17、19、21、22、23、27 日
- **台北富邦**：每月 2、4、6、8、10、12、14、16、18、20、22、24、26 日
- **台新銀行**：每月 2、7、12、17、20、22、27 日
- **星展銀行**：每月 1-26 日都可選擇
- **永豐商銀**：每月 5、9、12、14、16、18、21、23、26 日
- **滙豐銀行**：每月 3、6、9、12、15、18、21、24、27 日
- **三信商銀**：每月 5 日
- **新光銀行**：每月 2、12、14、23、27 日
- **玉山商銀**：每月 3、5、7、11、13、15、21、25、27、28 日
- **第一銀行**：每月 3、5、10、12、20、30、31 日
- **聯邦商銀**：每月 3、6、9、12、17、19、22、27、29 日
- **遠東商銀**：每月 1、2、4、5、7、10、13、16、17、19、22、25、27 日
- **上海商銀**：每月 2、6、11、16、21、26 日
- **元大商銀**：每月 1、6、10、18、22、26 日
- **兆豐商銀**：每月 3、6、9、12、15、18、21、24、27 日
- **凱基銀行**：每月 4、8、12、16、19、22、25、30、31 日
- **台中商銀**：每月 5 日
- **合作金庫**：每月 1 日
- **土地銀行**：每月 3、6、9、13、16、19、23、26、30 日
- **彰化銀行**：每月最後一天
- **渣打商銀**：每月 2、5、13、14、19、26、27 日
- **臺灣企銀**：每月 1、7 日
- **臺灣銀行**：每月 5、15、25 日
- **華南商銀**：每月 1、7、17、23 日
- **華泰銀行**：每月 3 日
- **陽信銀行**：每月 3 日
- **高雄銀行**：每月 4、7、14、17、24、27 日

### 繳款日計算規則
- **結帳日加天數**：大部分銀行採用此模式
  - 中國信託：結帳日+18天
  - 國泰世華：結帳日+16天
  - 台北富邦：結帳日+16天
  - 台新銀行：結帳日+15天
  - 星展銀行：結帳日+18天
  - 永豐商銀：結帳日+15天
  - 滙豐銀行：結帳日+18天
  - 新光銀行：結帳日+16天
  - 玉山商銀：結帳日+15天
  - 第一銀行：結帳日+15天
  - 聯邦商銀：結帳日+15天
  - 上海商銀：結帳日+18天
  - 元大商銀：結帳日+17天
  - 兆豐商銀：結帳日+15天
  - 凱基銀行：結帳日+17天
  - 土地銀行：結帳日+14天
  - 彰化銀行：結帳日+18天
  - 渣打商銀：結帳日+21天
  - 臺灣企銀：結帳日+14天（1日結帳）或+8天（7日結帳）
  - 臺灣銀行：結帳日+10天
  - 華南商銀：結帳日+15天
  - 高雄銀行：結帳日+15天

- **固定繳款日**：特定銀行採用固定日期
  - 三信商銀：每月20日
  - 台中商銀：每月21日
  - 合作金庫：每月15日
  - 華泰銀行：每月21日
  - 陽信銀行：每月18日

- **特殊規則**：
  - 遠東商銀：固定繳款日為每月20、24、28、3、7、13日
  - 彰化銀行：月底結帳，結帳日+18天

## 🟢 介面優化完成

### 1. 改善時間軸視覺呈現
- **問題**：單筆消費重複顯示造成混淆
- **改善**：
  - 只顯示消費日，不重複顯示入帳日
  - 保留入帳日資訊用於計算
  - 時間軸更清晰易讀

### 2. 介面整合優化
- **改善**：信用卡設定與消費記錄合併顯示
- **優勢**：
  - 減少頁面空間佔用
  - 提升操作流程連貫性
  - 改善整體用戶體驗

### 3. 銀行選擇介面優化
- **改善**：智能銀行名稱輸入與提示
- **優勢**：
  - 單一輸入框支援選擇和輸入
  - 智能提示提升選擇效率
  - 介面更簡潔統一

## 🎯 功能增強完成

### 1. 多卡片管理優化
- **改善**：多張信用卡使用體驗
- **功能**：
  - 銀行統計頁面顯示各銀行債務狀況
  - 支援按銀行篩選記錄
  - 銀行設定參數獨立管理

## 🚀 技術改進

### 1. 程式碼結構優化
- 添加 TypeScript 類型註解
- 改善函數參數傳遞
- 統一錯誤處理邏輯

### 2. 狀態管理改善
- 編輯狀態獨立管理
- 銀行設定記憶功能
- 繳款類型選項動態生成

### 3. 使用者體驗提升
- 編輯功能無需刪除重建
- 銀行設定自動填入
- 繳款類型選擇更直觀
- 介面整合減少操作步驟

## 📱 使用說明

### 基本操作流程
1. **設定銀行**：從預設銀行列表中選擇或輸入銀行名稱，系統會自動填入已設定的參數
2. **新增消費**：在同一頁面直接輸入消費金額、日期和說明
3. **新增繳款**：選擇繳款類型，系統會自動計算建議金額
4. **查看結果**：系統自動計算循環利息和下期帳單
5. **管理記錄**：支援編輯和刪除記錄

### 編輯記錄
- 點擊記錄旁的編輯按鈕（📄）
- 修改金額、日期、說明等資訊
- 點擊保存完成編輯

### 銀行管理
- 在銀行名稱欄位從預設列表選擇銀行
- 系統自動填入該銀行的利率、結帳日等參數
- 支援手動輸入新銀行名稱

## 🔧 安裝與執行

```bash
# 安裝依賴
npm install

# 開發模式
npm run dev

# 建置
npm run build

# 啟動
npm start
```

## 🎨 技術架構

- **前端框架**：Next.js + React
- **樣式**：Tailwind CSS
- **UI 組件**：Radix UI
- **圖示**：Lucide React
- **狀態管理**：React Hooks
- **類型檢查**：TypeScript

## 📝 更新日誌

### v3.0.0 (最新)
- 🟡 批次刪除功能優化：新增批次選擇、批次刪除和全部刪除功能
- 🟡 記錄管理效率提升：支援多筆記錄同時操作，減少重複操作
- 🟡 用戶體驗改善：新增全選/取消全選功能，提升操作便利性

### v2.9.0
- 🟡 介面簡化優化：刪除繳款狀態和循環利息卡片，讓介面更簡潔
- 🟡 專注核心功能：保留下期帳單預估的詳細明細，提升用戶體驗
- 🟡 減少視覺干擾：簡化計算結果顯示，讓用戶專注於重要資訊

### v2.8.0
- 🟡 繳款狀態簡化：專注顯示繳款狀況和剩餘欠款，移除循環利息資訊
- 🟡 下期帳單明細優化：新增帳單總額組成明細，清楚顯示費用結構
- 🟡 費用分類視覺化：使用顏色區分不同費用類型，提升辨識度

### v2.7.0
- 🟡 循環利息顯示邏輯優化：根據實際業務邏輯調整顯示順序和內容
- 🟡 循環利息卡片位置調整：移至繳款狀態下方，符合邏輯順序
- 🟡 循環利息產生原因說明：明確說明是「上期未繳清產生的」

### v2.6.0
- 🟡 銀行選擇體驗優化：選擇銀行後下拉選單自動隱藏，提升介面整潔度
- 🟡 繳款狀態與循環利息整合：將循環利息資訊整合到繳款狀態顯示中
- 🟡 循環利息提醒功能：警告未繳清將產生循環利息，提升用戶警覺性

### v2.5.0
- 🟡 銀行日期計算規則整合：根據實際銀行規則自動計算結帳日和繳款截止日
- 🟡 銀行結帳日選擇優化：智能結帳日選擇介面，支援銀行特定選項
- 🟡 26家銀行完整規則：包含中國信託、國泰世華、台新銀行等主要銀行的實際日期規則

### v2.4.0
- 🟡 銀行選擇介面整合：將下拉式選單和自行輸入合併為智能組合輸入框
- 🟡 智能銀行選擇：支援直接輸入、智能提示和快速選擇

### v2.3.0
- 🟡 銀行選擇介面完善：添加下拉式選單，雙重支援選擇與輸入
- 🟡 佈局優化：循環利息計算結果移至中間，信用卡使用紀錄移至右側
- 🟡 介面標題簡化：統一使用"信用卡使用紀錄"

### v2.2.0
- 🟡 銀行選擇體驗優化：智能銀行名稱輸入與提示
- 🟡 介面標題優化：改善用戶介面標題和描述
- 🟡 銀行選擇介面簡化：移除分離按鈕，統一輸入體驗

### v2.1.0
- 🟡 介面整合優化：信用卡基本設定與新增消費記錄合併
- 🟡 預設銀行名稱列表：包含26家主要台灣銀行
- 🟡 改善銀行選擇體驗：預設銀行 + 已使用銀行

### v2.0.0
- 🔴 修復循環利息計算邏輯
- 🔴 修復銀行統計計算錯誤
- 🔴 修復下期帳單計算問題
- 🔴 修復時間軸重複顯示
- 🟡 增加違約金計算
- 🟡 合併繳款類型選項
- 🟡 增加編輯功能
- 🟡 增加銀行資訊記憶功能
- 🟢 改善時間軸視覺呈現
- 🎯 多卡片管理優化

### v1.0.0
- 基本循環利息計算功能
- 消費和繳款記錄管理
- 銀行統計功能
- 時間軸顯示

### 18. 介面簡化優化
- **功能**：簡化計算結果顯示，移除繳款狀態和循環利息卡片
- **改善**：
  - 刪除繳款狀態卡片，讓介面更簡潔
  - 刪除循環利息獨立卡片，減少視覺干擾
  - 保留下期帳單預估的詳細明細，讓用戶清楚了解費用結構
  - 介面更加專注於核心計算結果，提升用戶體驗

### 19. 批次刪除功能優化
- **功能**：新增批次刪除和全部刪除功能，提升記錄管理效率
- **改善**：
  - 信用卡使用紀錄支援批次選擇和刪除
  - 記錄管理頁面支援批次選擇和刪除
  - 新增全部刪除按鈕，可一鍵刪除指定銀行的所有記錄
  - 支援全選/取消全選功能，提升操作便利性
  - 批次操作時顯示選中數量，讓用戶清楚了解操作範圍
